os: linux
dist: xenial
language: python

_aliases:
  - &docs
    python: 3.6
    install:
      - pip install sphinx
      - pip install numpydoc
    script: sphinx-build -W --keep-going doc _build/html

jobs:
  include:

    - stage: Tests

    # Test Code
      python: 2.6
      dist: trusty
    - python: 2.7
    - python: 3.3
      dist: trusty
    - python: 3.4
    - python: 3.5
    - python: 3.6
    - python: 3.7
    - python: 3.8

    # Test Docs
    - name: docs
      <<: *docs

    # Upload Docs to GitHub Pages
    - stage: Upload docs to GitHub Pages
      <<: *docs
      before_deploy:
        - VERSION=$(python setup.py --version)
        - tar -C _build/html -zcf _build/docs_v${VERSION}.tar.gz .
        - rm -rf _build/html
      deploy:
        provider: pages
        edge: true
        local_dir: _build/
        commit_message: Deploy %{project_name}
        keep_history: false
        on:
          all_branches: true
      if: (type = push) AND ((tag IS present) OR (branch = master))

install:
  - if [[ $TRAVIS_PYTHON_VERSION == 3.3 ]]; then
      pip install virtualenv==15.2.0;
      pip install pluggy==0.5.2;
      pip install tox==2.9.1;
    fi
  - if [[ $TRAVIS_PYTHON_VERSION == 2.7 ]]; then
      pip install tox==3.7.0;
    fi
  - pip install tox-travis

script:
  - tox

notifications:
  if: branch = master
